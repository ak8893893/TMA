<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFT Wallet Demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        .container { padding: 20px; max-width: 1200px; margin: 0 auto; }
        .button { 
            background: #3498db; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        .button:hover { background: #2980b9; }
        .nft-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .nft-card {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const ERC721_ABI = [
            "function balanceOf(address owner) view returns (uint256)",
            "function tokenOfOwnerByIndex(address owner, uint256 index) view returns (uint256)",
            "function tokenURI(uint256 tokenId) view returns (string)"
        ];

        function NFTWalletDemo() {
            const [account, setAccount] = React.useState('');
            const [nfts, setNfts] = React.useState([]);
            const [isConnected, setIsConnected] = React.useState(false);

            const connectWallet = async () => {
                try {
                    if (window.ethereum) {
                        const accounts = await window.ethereum.request({
                            method: 'eth_requestAccounts'
                        });
                        setAccount(accounts[0]);
                        setIsConnected(true);
                        fetchNFTs(accounts[0]);
                    } else {
                        alert('請安裝 MetaMask!');
                    }
                } catch (error) {
                    console.error('連接錢包錯誤:', error);
                    alert('連接錢包失敗: ' + error.message);
                }
            };

            const fetchNFTs = async (userAddress) => {
                try {
                    const provider = new ethers.providers.Web3Provider(window.ethereum);
                    const contract = new ethers.Contract(
                        '0xc799d8f3ad911a03ac1e1f93baa2e961b4047803', // 替換為您的NFT合約地址
                        ERC721_ABI,
                        provider
                    );

                    const balance = await contract.balanceOf(userAddress);
                    const tokenIds = [];

                    for (let i = 0; i < balance; i++) {
                        const tokenId = await contract.tokenOfOwnerByIndex(userAddress, i);
                        const tokenUri = await contract.tokenURI(tokenId);
                        tokenIds.push({
                            id: tokenId.toString(),
                            uri: tokenUri
                        });
                    }

                    setNfts(tokenIds);
                } catch (error) {
                    console.error('獲取NFT錯誤:', error);
                    alert('獲取NFT失敗: ' + error.message);
                }
            };

            return (
                <div className="container">
                    <h1>NFT 展示 Demo</h1>
                    
                    {!isConnected ? (
                        <button className="button" onClick={connectWallet}>
                            連接錢包
                        </button>
                    ) : (
                        <div>
                            <p>已連接錢包: {account}</p>
                            <div className="nft-grid">
                                {nfts.map((nft) => (
                                    <div key={nft.id} className="nft-card">
                                        <h3>Token ID: {nft.id}</h3>
                                        <p>Token URI: {nft.uri}</p>
                                    </div>
                                ))}
                            </div>
                            {nfts.length === 0 && (
                                <p>沒有找到NFT</p>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<NFTWalletDemo />);
    </script>
</body>
</html>